\chapter{Medición de estímulos eléctricos}
\section{\obj}
\capacidad
\begin{itemize}
    \item Configurar un sensor digital para lograr una medición eléctrica con la mayor resolución posible.
    \item Calcular el error asociado a la medición utilizando una multimetro digital de alta precisión.
\end{itemize}

\section{\mat}
\textbf{A suministrar por la Escuela:}
\begin{itemize}
    \item 1 ARDUINO UNO R4 MINIMA
    \item 1 sensor digital de voltaje, corriente y potencia (INA219)
    \item 1 mini breadboard
    \item Cables de interconexión (jumpers) macho-macho
\end{itemize}

\section{\pro}
\begin{enumerate}
        
    \item Realice las conexiones del circuito tal y como se indica en la Figura \ref{fig:L1F1}.
    \item Abra el programa Arduino IDE
    
    \begin{figure}[H]
        \tikzset{comm/.style={muxdemux, muxdemux def={Lh=5, Rh=5, NL=2, NB=0, NR=0, w=2}}}
        \tikzset{INA219/.style={muxdemux, muxdemux def={Lh=5, Rh=5, NL=2, NB=0, NR=6, w=2}}}
        \centering
        \begin{circuitikz} 
            \draw (0,3.5) node[comm] (m){\rotatebox{90}{\small communication}}
            (0,0) node[comm] (p){\rotatebox{90}{\small power}}
            ;
            \draw (m.blpin 1) node[above left]{\small SDA};
            \draw (m.blpin 2) node[above left]{\small SCL};
            \draw (p.blpin 1) node[above left]{\small GND};
            \draw (p.blpin 2) node[above left]{\small +5V};
            \draw (-5,3.2) node[INA219] (s){\rotatebox{90}{\small INA219}}
            (s.brpin 1) node[above right]{\scriptsize IN+}
            (s.brpin 2) node[above right]{\scriptsize IN-}
            (s.brpin 3) node[above right]{\scriptsize SDA}
            (s.brpin 4) node[above right]{\scriptsize SCL}
            (s.brpin 5) node[above right]{\scriptsize GND}
            (s.brpin 6) node[above right]{\scriptsize VCC}
            (s.blpin 1) node[above left]{\scriptsize IN+}
            (s.blpin 2) node[above left]{\scriptsize IN-}
            ;
            \draw[blue]
            (p.blpin 2) -- ++ (-2.8,0)
            |-
            (s.brpin 6)
            ;
            \draw[green]
            (p.blpin 1) -- ++ (-2.4,0)
            |-
            (s.brpin 5)
            ;
            \draw[red]
            (m.blpin 2) -- ++ (-2.4,0)
            |- 
            (s.brpin 4)
            ;
            \draw[brown]
            (m.blpin 1) -- ++ (-2.8,0)
            |- 
            (s.brpin 3)
            ;
            \draw[dashed,blue]
            (-2.5,6) -- (1,6)node[midway, below]{UNO R4 MINIMA} -- (1,-1.5) -- (-2.5,-1.5) -- cycle
            ;
            \draw
            (-9,-1)
            to[V, v^=\SI{5}{\volt}]
            (-9,3.5)
            |-
            (s.blpin 1)
            (s.blpin 2)
            to[short,i=$i_R$]
            ++(-1,0)
            -|
            (-7,2)
            to[R, l=$R$, v={$v_R$}]
            ++(0,-2)
            |-
            (-9,-1)
            ;
            \draw[green]
            (-7,-1) -- ++ (1,0)
            |-
            (p.blpin 1)
            ;
        \end{circuitikz}
    \caption{Conexión de sensor de corriente y voltaje INA219}
    \label{fig:pres1}
    \end{figure}

    \item Incluya el siguiente código en el Arduino IDE
    {\scriptsize 
        \lstinputlisting[language=Arduino, numbers=none, showstringspaces=false]{L01/L01.ino}
    }

    \item Tomando en cuenta el valor de la resistencia que se le asignó, calcule el valor de la corriete esperada en el circuito utilizando la Ley de Ohm.
    \item Investigue en el datasheet que significa el parametro PGA y como se relaciona con el rango del sensor. Ver 8.5.1
    \item Configure el sensor para que el rango de medición sea el más adecuado para la resistencia que se le asignó, suba el código modificado al Arduino.
    \item Realice dos mediciones de 10s de duración con una frecuencia de 1Hz al mismo tiempo que mide la corriente con un multímetro digital de alta precisión.
    \item Calibre el sensor utilizando un multímetro digital de alta precisión y cambie nuevamente el código para que el valor medido por el sensor sea lo más cercano posible al valor medido por el multímetro. Ver 8.5.2.1. Suba el código modificado al Arduino.
    \item Realice dos mediciones de 10s de duración con una frecuencia de 1Hz al mismo tiempo que mide la corriente con un multímetro digital de alta precisión.
    \item Modifique el código para que tener oversampling de 100 muestras por segundo y suba el código modificado al Arduino.
    \item Realice dos mediciones de 10s de duración con una frecuencia de 100Hz al mismo tiempo que mide la corriente con un multímetro digital de alta precisión.
    \item Para cada ser de medicines calcule lo siguiente e incluya en una tabla:
        \begin{itemize}
            \item El valor promedio, $\overline{i_R}$ 
            \item La desviación estándar, $\sigma$
            \item El valor de la incertidumbre estándar, $\sigma_x = \sigma / \sqrt{n}$
            \item La exactitud
            \item La precisión
            \item La repetibilidad
        \end{itemize}
        
    \item Tome en cuenta lo siguiente:
        \begin{itemize}
            \item La exactitud se calculará como el mayor error relativo obtenido en cualquier punto de los datos en todas las corridas de medición.
            \item La precisión se calculará como la mayor desviación estándar entre todas las corridas de medición.
            \item La repetibilidad se calculará de la siguiente manera:
            \begin{equation*}
                \mathrm{repetibilidad} = \sqrt{\dfrac{\sum_{i=1}^n(\mathrm{error\,absoluto})^2}{n}}
            \end{equation*}
        \end{itemize}


    \section{Preguntas para el analisis de resultados}
    \begin{itemize}
        \item ¿Cómo afecta el valor de la resistencia al rango de medición del sensor?
        \item ¿Como afecta el valor de PGA al rango de medición del sensor? 
        \item ¿En que consiste el oversampling y cómo afecta la resolución de la medición?
        \item ¿Que es lo que más afecta la precisión de la medición?
        \item ¿Qué es lo que más afecta la exactitud de la medición?
    \end{itemize}
    % \section{Resultados}

    % \begin{table}[H]
    %     \centering
    %     \caption{Mediciones tomadas a una frecuencia de \SI{1}{\hertz}}
    %     \vspace{0.5cm}
    %     \begin{tabular}{ccccccc}%
    %     \toprule
    %     \bfseries &  \multicolumn{2}{c}{\textbf{corrida 1}} & \multicolumn{2}{c}{\textbf{corrida 2}} & \multicolumn{2}{c}{\textbf{corrida 3}}\\
    %     \bfseries $t$ & \bfseries $i$ & \bfseries $v_1$ & \bfseries $i$ & \bfseries $v_1$ & \bfseries $i$ & \bfseries $v_1$\\
    %     {[\si{\second}]} & [\si{\ampere}] & [\si{\volt}] & [\si{\ampere}] & [\si{\volt}] & [\si{\ampere}] & [\si{\volt}]\\
    %     \midrule
    %     \csvreader[
    %         late after line=\\,
    %         late after last line=,
    %         before reading={\catcode`\#=12},
    %         after reading={\catcode`\#=6}]%
    %         {data.csv}{1=\t,2=\ci,3=\vi,4=\cii,5=\vii,6=\ciii,7=\viii}{\t &\ci & \vi &\cii & \vii &\ciii & \viii}\\
    %         \bottomrule
    %     \end{tabular}
    %     \label{tab:L1T1}
    % \end{table}
\end{enumerate}